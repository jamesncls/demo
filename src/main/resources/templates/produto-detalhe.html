<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="'Concept - ' + ${produto.nome}">Concept - Produto</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <header>
    <div class="top-bar">
      <h1>Concept</h1>
      <div style="margin-left:auto; display: flex; align-items: center;">
        <span th:if="${usuarioLogado}">
          <a href="/carrinho" class="carrinho-icon" title="Ir para o carrinho" style="margin-right:18px;">ðŸ›’</a>
          <a href="/perfil" class="perfil-icon" title="Perfil do usuÃ¡rio">ðŸ‘¤</a>
        </span>
        <span th:unless="${usuarioLogado}">
          <a href="/login" class="btn-login-topo">Login</a>
          <a href="/cadastro" class="btn-cadastro-topo">Cadastrar</a>
        </span>
      </div>
    </div>
    <nav>
      <a class="ativo" th:text="${produto.nome}">Produto</a>
    </nav>
  </header>
  <main>
    <div class="produtos-box">
      <div>
        <img th:src="@{${produto.imagem}}" th:alt="${produto.nome}" style="width:220px;">
      </div>
      <div style="margin-left:50px;">
        <h2 th:text="${produto.nome}"></h2>
        <div><b>Cor:</b> <span th:text="${produto.cor}"></span></div>
        <div><b>PreÃ§o:</b> R$ <span th:text="${produto.preco}"></span></div>
        <div class="tamanhos" style="margin-top:20px;">
          <h3 style="font-size:1.1em;">Tamanhos</h3>
          <div class="botoes-tamanho">
            <button>P</button>
            <button>M</button>
            <button>G</button>
            <button>GG</button>
          </div>
        </div>
        <div class="rodape">
            <span th:if="${usuarioLogado}">
                <a href="/carrinho" class="btn-adicionar" style="margin-top:20px; display:inline-block; text-align:center; text-decoration:none;">
                ðŸ›’ Adicionar ao carrinho
                </a>
            </span>
            <span th:unless="${usuarioLogado}">
                <a href="/login" class="btn-adicionar" style="margin-top:20px; display:inline-block; text-align:center; text-decoration:none;">
                ðŸ›’ Adicionar ao carrinho
                </a>
            </span>
        </div>
      </div>
    </div>
    <a href="/produtos" class="btn-voltar"><span>&#9664;</span></a>
  </main>
</body>

<script>
  // SeleÃ§Ã£o de tamanho
  document.querySelectorAll('.botoes-tamanho button').forEach(btn => {
    btn.addEventListener('click', function() {
      if (this.classList.contains('selected')) {
        this.classList.remove('selected');
      } else {
        document.querySelectorAll('.botoes-tamanho button').forEach(b => b.classList.remove('selected'));
        this.classList.add('selected');
      }
      removerAviso();
    });
  });

  // Cria aviso se nÃ£o existir
  function mostrarAviso(msg) {
    let aviso = document.getElementById('aviso-tamanho');
    if (!aviso) {
      aviso = document.createElement('div');
      aviso.id = 'aviso-tamanho';
      aviso.style.color = '#a34d4d';
      aviso.style.marginTop = '12px';
      aviso.style.fontWeight = 'bold';
      aviso.style.fontSize = '1em';
      let rodape = document.querySelector('.rodape');
      rodape.parentNode.insertBefore(aviso, rodape.nextSibling);
    }
    aviso.textContent = msg;
  }

  function removerAviso() {
    let aviso = document.getElementById('aviso-tamanho');
    if (aviso) aviso.remove();
  }

  // LÃ³gica para adicionar/remover do carrinho
  document.querySelectorAll('.btn-adicionar').forEach(btn => {
    btn.addEventListener('click', function(event) {
      event.preventDefault();
      // Thymeleaf injeta o valor de usuarioLogado
      var usuarioLogado = /*[[${usuarioLogado}]]*/ true;
      const tamanhoSelecionado = document.querySelector('.botoes-tamanho button.selected');
      removerAviso();

      if (!usuarioLogado) {
        window.location.href = "/login";
        return;
      }

      if (!tamanhoSelecionado) {
        mostrarAviso('Antes de adicionar o produto ao carrinho, selecione um tamanho para a camiseta');
        this.classList.remove('selected');
        this.textContent = 'ðŸ›’ Adicionar ao carrinho';
        return;
      }

      if (!this.classList.contains('selected')) {
        this.classList.add('selected');
        this.textContent = 'Adicionado ao Carrinho';
      } else {
        this.classList.remove('selected');
        this.textContent = 'ðŸ›’ Adicionar ao carrinho';
      }
    });
  });
</script>
</html>